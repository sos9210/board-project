<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{fragment/layout}">

<div layout:fragment="content" class="container">
    <div class="bs-docs-section">
        <div class="row">
            <div class="col-lg-12">
                <div class="page-header">
                    <h1 id="forms">게시글 수정</h1>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-6">
                <div class="bs-component">
                    <form name="editForm">
                        <fieldset>
                            <div class="form-group row">
                                <label for="staticEmail" class="col-sm-2 col-form-label">아이디</label>
                                <div class="col-sm-10">
                                    <input type="text" readonly="" class="form-control-plaintext" id="staticEmail" value="asd123">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="subject" class="form-label mt-4">제목</label>
                                <input type="text" class="form-control" id="subject" name="subject" th:value="${view.subject}" aria-describedby="emailHelp">
                            </div>
                            <div class="form-group">
                                <label for="content" class="form-label mt-4">내용</label>
                                <textarea class="form-control" id="content" name="content" th:text="${view.content}" rows="12"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="formFile" class="form-label mt-4">첨부파일</label>
                                <button type="button" class="btn btn-success" id="fileSelect">파일선택</button>
                                <div class="form-control" id="fileNameText" th:text="${view.attachFile.realFileName}">첨부파일을 선택해주세요</div>
                                <input class="form-control" type="file" id="formFile" name="formFile" style="display:none;">
                            </div>
                          <button type="button" id="editBtn" class="btn btn-primary mt-4">수정</button>
                        </fieldset>
                    </form>
                </div>
            </div>

        </div>
    </div>
</html>
<script th:inline="javascript">
document.getElementById('formFile').onchange = function() {
    document.getElementById('fileNameText').text(document.getElementById('formFile')[0].files[0].name);
}
document.getElementById('fileSelect').onclick = function() {
    document.getElementById('fileNameText').text('첨부파일을 선택해주세요');
    document.getElementById('formFile').click();
}

    var editBtn = document.getElementById("editBtn");
    editBtn.addEventListener("click", () => {
        var params = {
            subject : document.getElementById("subject").value,
            content : document.getElementById("content").value
        };

        //XMLHttpRequest 객체 생성
        var xhr = new XMLHttpRequest();

        //요청을 보낼 방식, url, 비동기여부 설정
        xhr.open('PATCH', '/board/user/forum/edit/[[${view.boardSn}]]', true);
        xhr.setRequestHeader('Content-Type', 'application/json');

        //요청 전송
        xhr.send(JSON.stringify(params));

        //Callback
        xhr.onload = () => {
            if (xhr.status == 200) {
                //success
                alert(xhr.response);
                location.href = "/board/user/forum/[[${view.boardSn}]]";
            } else {
                alert(xhr.response);
            }
        }
    });
</script>